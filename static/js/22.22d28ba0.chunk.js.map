{"version":3,"sources":["components/pages/home/reducer.js","components/pages/home/index.js"],"names":["initialState","films","isLoading","isAllFetched","isInitialLoaded","error","homePageReducer","state","action","type","fieldName","payload","Set","length","pageInitialMaxFetchCount","pageMaxFetchCount","Home","history","useHistory","useReducer","dispatch","handleOnHomePageData","useCallback","useBottomScrollListener","triggerOnNoScroll","useEffect","a","filmApi","limit","then","res","response","data","forEach","film","img","process","id","catch","err","console","fetchData","skip","getAllFilms","handleRedirect","push","pathname","className","map","index","Array","_"],"mappings":"wNAEaA,EAAe,CACxBC,MAAO,KACPC,WAAW,EACXC,cAAc,EACdC,iBAAiB,EACjBC,MAAO,MAGEC,EAAkB,SAACC,EAAOC,GACnC,OAAQA,EAAOC,MACX,IAAK,QACD,OAAO,2BACAF,GADP,kBAEKC,EAAOE,UAAYF,EAAOG,UAGnC,IAAK,OACD,OAAO,2BACAJ,GADP,IAEIL,WAAW,EACXC,cAAc,EACdE,MAAO,KAGf,IAAK,eACD,OAAO,2BACAE,GADP,IAEIN,MAAM,YAAK,IAAIW,IAAJ,YAAYJ,EAAOG,WAC9BT,WAAW,EACXE,iBAAiB,EACjBD,aAAcK,EAAOG,QAAQE,OAASC,MAG9C,IAAK,UACD,OAAO,2BACAP,GADP,IAEIN,MAAM,YAAK,IAAIW,IAAJ,sBAAYL,EAAMN,OAAlB,YAA4BO,EAAOG,YAC9CT,WAAW,EACXC,aAAcK,EAAOG,QAAQE,OAASE,IACtCV,MAAO,OAGf,IAAK,QACD,OAAO,2BACAE,GADP,IAEIL,WAAW,EACXC,cAAc,EACdE,MAAOG,EAAOG,UAGtB,QACI,OAAOJ,I,2CC4CJS,UAlFf,WAEI,IAAIC,EAAUC,cAEd,EAA0BC,qBAAWb,EAAiBN,GAAtD,mBAAOO,EAAP,KAAca,EAAd,KACQnB,EAAoDM,EAApDN,MAAOC,EAA6CK,EAA7CL,UAAWC,EAAkCI,EAAlCJ,aAAcC,EAAoBG,EAApBH,gBAElCiB,EAAuBC,uBAAY,WAChCpB,GAAcC,IAAgBC,GAC/BgB,EAAS,CACLX,KAAM,WAGf,CAACP,EAAWC,EAAcC,IAE7BmB,YAAwBF,EAAsB,CAAEG,mBAAmB,IAEnEC,qBAAU,WAAM,4CACZ,sBAAAC,EAAA,sEACUC,IAAY,CAAEC,MAAOd,MAA4Be,MAAK,SAAAC,GACxD,IAAIC,EAAWD,EAAIE,KAEnBD,EAASE,SAAQ,SAAAC,GACbA,EAAKC,IAAL,UAAcC,0DAAd,iBAAoDF,EAAKG,GAAzD,iBAIJjB,EAAS,CACLX,KAAM,eACNE,QAASoB,OAEdO,OAAM,SAAAC,GAAG,OAAIC,QAAQnC,MAAMkC,MAblC,4CADY,uBAAC,WAAD,wBAgBZE,KACD,IAEHhB,qBAAU,WAAM,4CACZ,sBAAAC,EAAA,sEACUC,IAAY,CAAEe,KAAMzC,EAAMY,OAAQe,MAAOb,MAC1Cc,MAAK,SAAAC,GACF,IAAIC,EAAWD,EAAIE,KAEnBD,EAASE,SAAQ,SAAAC,GACbA,EAAKC,IAAL,UAAcC,0DAAd,iBAAoDF,EAAKG,GAAzD,iBAIJjB,EAAS,CACLX,KAAM,UACNE,QAASoB,OAEdO,OAAM,SAAAC,GAAG,OAAIC,QAAQnC,MAAMkC,MAdtC,4CADY,sBAiBRrC,GAAaE,GAAmBH,GAjBvB,WAAD,wBAiB+B0C,KAC5C,CAACzC,EAAWE,EAAiBH,IAEhC,IAAM2C,EAAiB,SAACP,GACpBpB,EAAQ4B,KAAK,CAAEC,SAAU,UAAGV,2BAAH,SAA4CC,KAGzE,OACI,sBAAKU,UAAU,gBAAgBV,GAAG,WAAlC,UAEQpC,EAAQA,EAAM+C,KAAI,SAACd,EAAMe,GAAP,OAAiB,cAAC,IAAD,CAAoBf,KAAMA,EAAMe,MAAOA,EAAOL,eAAgBA,GAAnDV,EAAKG,OAC5C,YAAIa,MAAM,KAAKF,KAAI,SAACG,EAAGF,GAAJ,OAClB,cAAC,IAAD,GAAeA,OAKtB9C,GAAgB,qBAAK4C,UAAU,6CAAf,SAER7C,GACD,qBAAK6C,UAAU","file":"static/js/22.22d28ba0.chunk.js","sourcesContent":["import { pageInitialMaxFetchCount, pageMaxFetchCount } from \"../../../config\"\r\n\r\nexport const initialState = {\r\n    films: null,\r\n    isLoading: false,\r\n    isAllFetched: false,\r\n    isInitialLoaded: false,\r\n    error: null,\r\n}\r\n\r\nexport const homePageReducer = (state, action) => {\r\n    switch (action.type) {\r\n        case 'field': {\r\n            return {\r\n                ...state,\r\n                [action.fieldName]: action.payload\r\n            }\r\n        }\r\n        case 'load': {\r\n            return {\r\n                ...state,\r\n                isLoading: true,\r\n                isAllFetched: false,\r\n                error: ''\r\n            }\r\n        }\r\n        case 'initial-load': { \r\n            return {\r\n                ...state,\r\n                films: [...new Set([...action.payload])],\r\n                isLoading: false,\r\n                isInitialLoaded: true,\r\n                isAllFetched: action.payload.length < pageInitialMaxFetchCount,\r\n            }\r\n        }\r\n        case 'success': {\r\n            return {\r\n                ...state,\r\n                films: [...new Set([...state.films, ...action.payload])],\r\n                isLoading: false,\r\n                isAllFetched: action.payload.length < pageMaxFetchCount,\r\n                error: null\r\n            }\r\n        }\r\n        case 'error': {\r\n            return {\r\n                ...state,\r\n                isLoading: false,\r\n                isAllFetched: false,\r\n                error: action.payload\r\n            }\r\n        }\r\n        default:\r\n            return state\r\n    }\r\n}","import React, { useEffect, useReducer, useCallback } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\n\r\nimport { homePageReducer, initialState } from './reducer';\r\n\r\nimport Film from '../../models/film'\r\nimport Skeleton from '../../models/film/skeleton';\r\n\r\nimport * as filmApi from '../../../services/filmService'\r\n\r\nimport { pageMaxFetchCount, pageInitialMaxFetchCount } from '../../../config';\r\n\r\nimport useBottomScrollListener from '../../../helpers/hooks/useBottomScrollListener';\r\n\r\n\r\nfunction Home() {\r\n\r\n    let history = useHistory()\r\n\r\n    const [state, dispatch] = useReducer(homePageReducer, initialState)\r\n    const { films, isLoading, isAllFetched, isInitialLoaded } = state\r\n\r\n    const handleOnHomePageData = useCallback(() => {\r\n        if (!isLoading && !isAllFetched && isInitialLoaded) {\r\n            dispatch({\r\n                type: 'load'\r\n            })\r\n        }\r\n    }, [isLoading, isAllFetched, isInitialLoaded])\r\n\r\n    useBottomScrollListener(handleOnHomePageData, { triggerOnNoScroll: true })\r\n\r\n    useEffect(() => {\r\n        async function fetchData() {\r\n            await filmApi.all({ limit: pageInitialMaxFetchCount }).then(res => {\r\n                let response = res.data;\r\n\r\n                response.forEach(film => {\r\n                    film.img = `${process.env.REACT_APP_API_URL}films/${film.id}/thumbnail`\r\n\r\n                });\r\n\r\n                dispatch({\r\n                    type: 'initial-load',\r\n                    payload: response\r\n                })\r\n            }).catch(err => console.error(err))\r\n        }\r\n        fetchData()\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        async function getAllFilms() {\r\n            await filmApi.all({ skip: films.length, limit: pageMaxFetchCount })\r\n                .then(res => {\r\n                    let response = res.data;\r\n\r\n                    response.forEach(film => {\r\n                        film.img = `${process.env.REACT_APP_API_URL}films/${film.id}/thumbnail`\r\n\r\n                    });\r\n\r\n                    dispatch({\r\n                        type: 'success',\r\n                        payload: response\r\n                    })\r\n                }).catch(err => console.error(err))\r\n        }\r\n        if (isLoading && isInitialLoaded && films) getAllFilms()\r\n    }, [isLoading, isInitialLoaded, films])\r\n\r\n    const handleRedirect = (id) => {\r\n        history.push({ pathname: `${process.env.REACT_APP_PATH_NAME}film/` + id });\r\n    };\r\n\r\n    return (\r\n        <div className=\"row mt-5 mx-2\" id=\"homePage\">\r\n            {\r\n                films ? films.map((film, index) => <Film key={film.id} film={film} index={index} handleRedirect={handleRedirect} />)\r\n                    : ([...Array(20)].map((_, index) => (\r\n                        <Skeleton key={index} />\r\n                    )))\r\n            }\r\n\r\n            {\r\n                !isAllFetched && <div className=\"fetch-loader d-flex justify-content-center\">\r\n                    {\r\n                        (isLoading) &&\r\n                        <div className=\"spinner-border\" />\r\n                    }\r\n                </div>\r\n            }\r\n\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Home;\r\n"],"sourceRoot":""}