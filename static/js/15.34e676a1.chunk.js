(this.webpackJsonpfilmapp_frontened=this.webpackJsonpfilmapp_frontened||[]).push([[15],{521:function(e,t,a){"use strict";a.r(t);var n=a(15),s=a(528),r=a.n(s),c=a(529),i=a(46),l=a(1),o=a(7),u=a(81),d=a(137),m={name:"",email:""},f=Object(n.a)(Object(n.a)({},m),{},{password:"",initialUser:m,isInitialLoaded:!1,isSubmitted:!1,isSending:!1,error:"",isSuccess:!1,success:""}),b=function(e,t){switch(t.type){case"field":return Object(n.a)(Object(n.a)({},e),{},Object(d.a)({error:""},t.fieldName,t.payload));case"initial-success":return Object(n.a)(Object(n.a)({},e),{},{email:t.email,name:t.name,initialUser:{email:t.email,name:t.name},isInitialLoaded:!0});case"submit":return Object(n.a)(Object(n.a)({},e),{},{isSubmitted:!0,error:null});case"send":return Object(n.a)(Object(n.a)({},e),{},{isSending:!0});case"success":return Object(n.a)(Object(n.a)({},e),{},{isSubmitted:!1,isSending:!1,isSuccess:!0,success:t.payload?t.payload:"Changes saved successfully!",error:null});case"error":return Object(n.a)(Object(n.a)({},e),{},{isSending:!1,isSubmitted:!1,isSuccess:!1,error:t.payload});default:return e}},p=a(549),h=a(139),j=a(541),O=a(540),g=a(2);t.default=function(){var e=Object(l.useContext)(u.a),t=e.user,a=e.clearUser,s=e.updateUser,d=Object(o.g)(),m=Object(o.h)(),v=Object(l.useReducer)(b,f),y=Object(i.a)(v,2),x=y[0],w=y[1],N=x.email,S=x.name,M=x.password,C=x.initialUser,D=x.isSubmitted,k=x.isSending,I=x.isInitialLoaded,E=x.success,U=x.isSuccess,F=x.error;Object(l.useEffect)((function(){!t.auth&&t.isInitialLoaded&&(d.replace("".concat("/filmapp-react-frontend/")),d.push("".concat("/filmapp-react-frontend/","login")),a())}),[t,d,a]),Object(l.useEffect)((function(){function e(){return(e=Object(c.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a().then((function(e){w({type:"initial-success",name:e.data.name,email:e.data.email})})).catch((function(e){console.error(e),w({type:"error",payload:!0})}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(l.useEffect)((function(){function e(){return(e=Object(c.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={},M&&M.length>6&&(t={password:M}),N&&(t=Object(n.a)(Object(n.a)({},t),{},{email:N})),S&&(t=Object(n.a)(Object(n.a)({},t),{},{name:S})),e.next=6,p.b(t).then((function(e){w({type:"success"}),setTimeout((function(){Object(O.b)(d,"/settings"),s(e.data.accessToken)}),500)})).catch((function(e){console.error(e),w({type:"error",payload:e.response&&e.response.data&&e.response.data.error?e.response.data.error:"Something went wrong!"})}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}k&&function(){e.apply(this,arguments)}()}),[N,k,S,M,d,m,s]);return Object(g.jsxs)(h.a,{id:"settingsModal",title:"Settings",onClose:function(){Object(O.b)(d,"/settings")},children:[Object(g.jsxs)("form",{onSubmit:k?null:function(e){e.preventDefault(),w({type:"submit"}),(M&&M.length>=6||N||S)&&w({type:"send"})},children:[Object(g.jsxs)("div",{children:[Object(g.jsx)("label",{className:"form-label",htmlFor:"name",children:"Name"}),Object(g.jsx)(j.a,{type:"text",name:"name",value:S,isInvalid:D&&!S,onChange:function(e){return w({type:"field",fieldName:"name",payload:e.target.value})}}),Object(g.jsx)("div",{className:"invalid-feedback",children:"Name cannot be empty"})]}),Object(g.jsxs)("div",{className:"mt-2 form-group",children:[Object(g.jsx)("label",{className:"form-label",htmlFor:"email",children:"Email"}),Object(g.jsx)(j.a,{type:"email",name:"email",value:N,isInvalid:D&&!N,onChange:function(e){return w({type:"field",fieldName:"email",payload:e.target.value})}}),Object(g.jsx)("div",{className:"invalid-feedback",children:"Email cannot be empty"})]}),Object(g.jsxs)("div",{className:"mt-2 form-group",children:[Object(g.jsx)("label",{className:"form-label",htmlFor:"password",children:"Password"}),Object(g.jsx)(j.a,{type:"password",name:"password",isInvalid:D&&M&&M.length<6,value:M,onChange:function(e){return w({type:"field",fieldName:"password",payload:e.target.value})}}),Object(g.jsx)("div",{className:"invalid-feedback",children:"Password must be at least 6 characters long!"})]}),Object(g.jsxs)("div",{className:"d-flex align-items-center mt-2",children:[Object(g.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:k||!I||I&&N===C.email&&S===C.name&&(!M||M&&M.length<6),children:"Change"}),k&&Object(g.jsx)("div",{className:"ml-2 spinner-grow"})]})]}),F&&Object(g.jsx)("div",{className:"alert alert-danger mt-2 mb-0",children:F||"Error while logging in."}),U&&Object(g.jsx)("div",{className:"alert alert-success mt-2 mb-0",children:E})]})}},528:function(e,t,a){e.exports=a(242)},529:function(e,t,a){"use strict";function n(e,t,a,n,s,r,c){try{var i=e[r](c),l=i.value}catch(o){return void a(o)}i.done?t(l):Promise.resolve(l).then(n,s)}function s(e){return function(){var t=this,a=arguments;return new Promise((function(s,r){var c=e.apply(t,a);function i(e){n(c,s,r,i,l,"next",e)}function l(e){n(c,s,r,i,l,"throw",e)}i(void 0)}))}}a.d(t,"a",(function(){return s}))},540:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"c",(function(){return s})),a.d(t,"b",(function(){return r}));var n=function(e){var t=new Date(Date.parse(e.createdAt));return("0"+t.getDate()).slice(-2)+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getFullYear()).slice(-2)+" o "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)},s=function(e){var t=new Date(Date.parse(e.createdAt)),a=new Date,n=Math.abs(Math.floor((Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes())-Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes()))/6e4));return n/60>=1?(n/=60)/24>=1?(n/=24)/30>=1?(n/=30)/12>=1?(n/=12,n=Math.floor(n)+" years "):n=Math.floor(n)+" months ":n=Math.floor(n)+" days ":n=Math.floor(n)+" hours ":n=Math.floor(n)+" minutes ",n+="ago"},r=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.location.pathname.split(t)[0],s={pathname:""===n?"/filmapp-react-frontend/":n,search:e.location.search,state:e.location.state};a?e.replace(s):e.push(s)}},541:function(e,t,a){"use strict";var n=a(1),s=a(2);t.a=function(e){var t=e.isInvalid,a=e.onChange,r=e.type,c=e.name,i=e.value,l=e.placeholder,o=void 0===l?"":l,u="textarea"===r?"textarea":"input",d=Object(n.useRef)(null);return Object(n.useEffect)((function(){d.current&&(t?d.current.classList.add("is-invalid"):d.current.classList.remove("is-invalid"))}),[t]),Object(s.jsx)(u,{ref:d,className:"form-control",placeholder:o,type:r,name:c,value:i,onChange:a})}},549:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return c}));var n=a(42),s=a(138),r=function(e){return n.a.get("users/me",{params:e,headers:Object(s.a)()})},c=function(e){return n.a.patch("users",e,{headers:Object(s.a)()})}}}]);
//# sourceMappingURL=15.34e676a1.chunk.js.map