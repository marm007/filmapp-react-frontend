{"version":3,"sources":["../node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator/index.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","services/userService.js","components/modals/settings/reducer.js","components/modals/settings/index.js"],"names":["module","exports","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined","me","params","axios","get","headers","authHeader","partialUpdate","body","patch","userInitialState","name","email","settingsInitialState","password","initialUser","isInitialLoaded","isSubmitted","isSending","success","settingsReducer","state","action","type","fieldName","payload","Settings","useContext","UserContext","user","clearUser","updateUser","history","useHistory","location","useLocation","useReducer","dispatch","useEffect","auth","replace","process","push","a","userApi","res","data","catch","console","getUser","toUpdate","setTimeout","pathname","slice","search","accessToken","response","updateUserData","id","title","onClose","goBack","onSubmit","e","preventDefault","className","htmlFor","placeholder","onChange","target","disabled"],"mappings":"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","file":"static/js/16.7cb5c840.chunk.js","sourcesContent":["module.exports = require(\"regenerator-runtime\");\n","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","import axios from '../helpers/axios'\nimport authHeader from '../helpers/authHeader'\n\n\nexport const me = (params) => axios.get('users/me', { params, headers: authHeader() })\nexport const partialUpdate = (body) => axios.patch('users', body, { headers: authHeader() })\n\nexport const userService = {\n    login,\n    logout,\n    register\n};\n\nfunction login(username, password) {\n\n    let loginHeaderMy = null\n\n    const requestOptions = {\n        method: 'POST',\n        headers: loginHeaderMy\n\n    };\n\n    return fetch(`${process.env.REACT_APP_API_URL}/users/auth`, requestOptions)\n        .then(handleResponse)\n        .then(user => {\n            localStorage.setItem('user', JSON.stringify(user));\n            return user;\n        })\n}\n\nfunction logout() {\n    localStorage.removeItem('user');\n}\n\nfunction register(user) {\n    const requestOptions = {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(user)\n    };\n    return fetch(`${process.env.REACT_APP_API_URL}/users/`, requestOptions)\n        .then(handleResponse);\n}\n\nfunction handleResponse(response) {\n    return response.text().then(text => {\n        const data = text && JSON.parse(text);\n        if (!response.ok) {\n            if (response.status === 401) {\n                logout();\n            }\n            const error = (data && data.errors) || response.statusText;\n            return Promise.reject(error);\n        }\n        return data;\n    })\n}\n\n","const userInitialState = {\n    name: '',\n    email: ''\n}\n\nexport const settingsInitialState = {\n    ...userInitialState,\n    password: '',\n    initialUser: userInitialState,\n    isInitialLoaded: false,\n    isSubmitted: false,\n    isSending: false,\n    error: '',\n    success: ''\n}\n\nexport const settingsReducer = (state, action) => {\n    switch (action.type) {\n        case 'field': {\n            return {\n                ...state,\n                error: '',\n                [action.fieldName]: action.payload\n            }\n        }\n        case 'initial-success': {\n            return {\n                ...state,\n                initialUser: {\n                    email: action.email,\n                    name: action.name\n                },\n                isInitialLoaded: true\n            }\n        }\n        case 'submit': {\n            return {\n                ...state,\n                isSubmitted: true,\n                error: null,\n            }\n        }\n        case 'send': {\n            return {\n                ...state,\n                isSending: true\n            }\n        }\n        case 'success': {\n            return {\n                ...state,\n                isSubmitted: false,\n                isSending: false,\n                success: 'Changes saved successfully!',\n                error: null\n            }\n        }\n        case 'error': {\n            return {\n                ...state,\n                isSending: false,\n                isSubmitted: false,\n                error: action.payload\n            }\n        }\n        default: return state\n    }\n}","import React, { useEffect, useReducer, useContext } from \"react\";\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport UserContext from \"../../../helpers/contexts/user/userContext\";\nimport { settingsInitialState, settingsReducer } from \"./reducer\";\nimport * as userApi from '../../../services/userService'\nimport Modal from \"../../helpers/modal\";\n\nconst Settings = () => {\n\n    const { user, clearUser, updateUser } = useContext(UserContext)\n\n    let history = useHistory()\n    let location = useLocation()\n\n    const [state, dispatch] = useReducer(settingsReducer, settingsInitialState)\n    // eslint-disable-next-line no-unused-vars\n    const { email, name, password, initialUser, isSubmitted, isSending, isInitialLoaded, success, error } = state\n\n\n    useEffect(() => {\n        if (!user.auth && user.isInitialLoaded) {\n            history.replace(`${process.env.REACT_APP_PATH_NAME}`)\n            history.push(`${process.env.REACT_APP_PATH_NAME}login`)\n            clearUser()\n        }\n    }, [user, history, clearUser])\n\n    useEffect(() => {\n        async function getUser() {\n            await userApi.me()\n                .then(res => {\n                    dispatch({\n                        type: 'initial-success',\n                        name: res.data.name,\n                        email: res.data.email\n                    })\n                })\n                .catch(err => {\n                    console.error(err)\n                    dispatch({\n                        type: 'error',\n                        payload: true\n                    })\n                })\n        }\n        getUser()\n    }, [])\n\n    useEffect(() => {\n        async function updateUserData() {\n            let toUpdate = {}\n            if (password) toUpdate = { password: password }\n            if (email && email !== '' && email !== initialUser.email) toUpdate = { ...toUpdate, email: email }\n            if (name && name !== '' && name !== initialUser.name) toUpdate = { ...toUpdate, name: name }\n\n            await userApi.partialUpdate(toUpdate)\n                .then(res => {\n                    dispatch({\n                        type: 'success'\n                    })\n\n                    setTimeout(() => {\n                        let pathname = location.pathname.slice(0, -9)\n                        if (pathname === '') pathname = process.env.REACT_APP_PATH_NAME\n                        history.replace({\n                            pathname: pathname,\n                            search: location.search,\n                            state: location.state\n                        })\n                        updateUser(res.data.accessToken)\n                    }, 500)\n                })\n                .catch(err => {\n                    console.error(err)\n                    dispatch({\n                        type: 'error',\n                        payload: err.response && err.response.data && err.response.data.error ? err.response.data.error : 'Something went wrong!'\n                    })\n                })\n        }\n        if (isSending) updateUserData()\n    }, [email, initialUser.email, initialUser.name, isSending, name, password, history, location, updateUser])\n\n\n    const handleSubmit = (e) => {\n        e.preventDefault()\n\n        dispatch({\n            type: 'submit'\n        })\n\n        if (password ||\n            (email && email !== '' && email !== initialUser.email) ||\n            (name && name !== '' && name !== initialUser.name)) {\n            dispatch({\n                type: 'send'\n            })\n        }\n    }\n\n    const modalClose = () => {\n        history.goBack()\n    }\n\n    return (\n        <Modal id=\"settingsModal\" title=\"Settings\" onClose={modalClose}>\n            <form onSubmit={isSending ? null : handleSubmit}>\n                <div>\n                    <label className=\"form-label\" htmlFor=\"name\">Name</label>\n                    <input className=\"form-control\" type=\"text\" name=\"name\"\n                        value={name} placeholder={initialUser.name}\n                        onChange={e => dispatch({ type: 'field', fieldName: 'name', payload: e.target.value })} />\n                </div>\n                <div className=\"mt-2\">\n                    <label className=\"form-label\" htmlFor=\"email\">Email</label>\n                    <input className=\"form-control\" type=\"email\" name=\"email\"\n                        value={email} placeholder={initialUser.email}\n                        onChange={e => dispatch({ type: 'field', fieldName: 'email', payload: e.target.value })} />\n                </div>\n                <div className=\"mt-2\">\n                    <label className=\"form-label\" htmlFor=\"password\">Password</label>\n                    <input className=\"form-control\" type=\"password\" name=\"password\"\n                        value={password} onChange={e => dispatch({ type: 'field', fieldName: 'password', payload: e.target.value })} />\n                </div>\n                <div className=\"d-flex align-items-center mt-2\">\n                    <button disabled={isSending || !isInitialLoaded} type=\"submit\" className=\"btn btn-primary\">\n                        Change\n                    </button>\n\n                    {\n                        isSending &&\n                        <div className=\"ml-2 spinner-grow\" />\n                    }\n                </div>\n            </form>\n            {\n                error &&\n                <div className=\"alert alert-danger mt-2 mb-0\">\n                    {error ? error : 'Error while logging in.'}\n                </div>\n            }\n            {\n                success &&\n                <div className=\"alert alert-success mt-2 mb-0\">\n                    {success}\n                </div>\n            }\n        </Modal>\n    )\n}\n\nexport default Settings"],"sourceRoot":""}