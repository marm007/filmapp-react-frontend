{"version":3,"sources":["components/dialogs/updateUser/reducer.js","components/dialogs/updateUser/index.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator/index.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","services/userService.js"],"names":["userInitialState","name","email","settingsInitialState","password","initialUser","isInitialLoaded","isSubmitted","isSending","error","success","settingsReducer","state","action","type","fieldName","payload","Settings","useContext","UserContext","user","clearUser","updateUser","history","useHistory","location","useLocation","useReducer","dispatch","useEffect","auth","replace","process","push","a","userApi","then","res","data","catch","err","console","getUser","toUpdate","setTimeout","pathname","slice","search","accessToken","response","updateUserData","id","title","onClose","goBack","onSubmit","e","preventDefault","className","htmlFor","value","placeholder","onChange","target","disabled","module","exports","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","done","Promise","_asyncToGenerator","fn","self","this","args","arguments","apply","undefined","me","params","axios","get","headers","authHeader","partialUpdate","body","patch"],"mappings":"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","file":"static/js/18.f17491d6.chunk.js","sourcesContent":["const userInitialState = {\r\n    name: '',\r\n    email: ''\r\n}\r\n\r\nexport const settingsInitialState = {\r\n    ...userInitialState,\r\n    password: '',\r\n    initialUser: userInitialState,\r\n    isInitialLoaded: false,\r\n    isSubmitted: false,\r\n    isSending: false,\r\n    error: '',\r\n    success: ''\r\n}\r\n\r\nexport const settingsReducer = (state, action) => {\r\n    switch (action.type) {\r\n        case 'field': {\r\n            return {\r\n                ...state,\r\n                error: '',\r\n                [action.fieldName]: action.payload\r\n            }\r\n        }\r\n        case 'initial-success': {\r\n            return {\r\n                ...state,\r\n                initialUser: {\r\n                    email: action.email,\r\n                    name: action.name\r\n                },\r\n                isInitialLoaded: true\r\n            }\r\n        }\r\n        case 'submit': {\r\n            return {\r\n                ...state,\r\n                isSubmitted: true,\r\n                error: null,\r\n            }\r\n        }\r\n        case 'send': {\r\n            return {\r\n                ...state,\r\n                isSending: true\r\n            }\r\n        }\r\n        case 'success': {\r\n            return {\r\n                ...state,\r\n                isSubmitted: false,\r\n                isSending: false,\r\n                success: 'Changes saved successfully!',\r\n                error: null\r\n            }\r\n        }\r\n        case 'error': {\r\n            return {\r\n                ...state,\r\n                isSending: false,\r\n                isSubmitted: false,\r\n                error: action.payload\r\n            }\r\n        }\r\n        default: return state\r\n    }\r\n}","import React, { useEffect, useReducer, useContext } from \"react\";\r\nimport { useHistory, useLocation } from \"react-router-dom\";\r\nimport UserContext from \"../../../helpers/contexts/user/userContext\";\r\nimport { settingsInitialState, settingsReducer } from \"./reducer\";\r\nimport * as userApi from '../../../services/userService'\r\nimport Modal from \"../../models/modal\";\r\n\r\nconst Settings = () => {\r\n\r\n    const { user, clearUser, updateUser } = useContext(UserContext)\r\n\r\n    let history = useHistory()\r\n    let location = useLocation()\r\n\r\n    const [state, dispatch] = useReducer(settingsReducer, settingsInitialState)\r\n    // eslint-disable-next-line no-unused-vars\r\n    const { email, name, password, initialUser, isSubmitted, isSending, isInitialLoaded, success, error } = state\r\n\r\n\r\n    useEffect(() => {\r\n        if (!user.auth && user.isInitialLoaded) {\r\n            history.replace(`${process.env.REACT_APP_PATH_NAME}`)\r\n            history.push(`${process.env.REACT_APP_PATH_NAME}login`)\r\n            clearUser()\r\n        }\r\n    }, [user, history, clearUser])\r\n\r\n    useEffect(() => {\r\n        async function getUser() {\r\n            await userApi.me()\r\n                .then(res => {\r\n                    dispatch({\r\n                        type: 'initial-success',\r\n                        name: res.data.name,\r\n                        email: res.data.email\r\n                    })\r\n                })\r\n                .catch(err => {\r\n                    console.error(err)\r\n                    dispatch({\r\n                        type: 'error',\r\n                        payload: true\r\n                    })\r\n                })\r\n        }\r\n        getUser()\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        async function updateUserData() {\r\n            let toUpdate = {}\r\n            if (password) toUpdate = { password: password }\r\n            if (email && email !== '' && email !== initialUser.email) toUpdate = { ...toUpdate, email: email }\r\n            if (name && name !== '' && name !== initialUser.name) toUpdate = { ...toUpdate, name: name }\r\n\r\n            await userApi.partialUpdate(toUpdate)\r\n                .then(res => {\r\n                    dispatch({\r\n                        type: 'success'\r\n                    })\r\n\r\n                    setTimeout(() => {\r\n                        let pathname = location.pathname.slice(0, -9)\r\n                        if (pathname === '') pathname = process.env.REACT_APP_PATH_NAME\r\n                        history.replace({\r\n                            pathname: pathname,\r\n                            search: location.search,\r\n                            state: location.state\r\n                        })\r\n                        updateUser(res.data.accessToken)\r\n                    }, 500)\r\n                })\r\n                .catch(err => {\r\n                    console.error(err)\r\n                    dispatch({\r\n                        type: 'error',\r\n                        payload: err.response && err.response.data && err.response.data.error ? err.response.data.error : 'Something went wrong!'\r\n                    })\r\n                })\r\n        }\r\n        if (isSending) updateUserData()\r\n    }, [email, initialUser.email, initialUser.name, isSending, name, password, history, location, updateUser])\r\n\r\n\r\n    const handleSubmit = (e) => {\r\n        e.preventDefault()\r\n\r\n        dispatch({\r\n            type: 'submit'\r\n        })\r\n\r\n        if (password ||\r\n            (email && email !== '' && email !== initialUser.email) ||\r\n            (name && name !== '' && name !== initialUser.name)) {\r\n            dispatch({\r\n                type: 'send'\r\n            })\r\n        }\r\n    }\r\n\r\n    const modalClose = () => {\r\n        history.goBack()\r\n    }\r\n\r\n    return (\r\n        <Modal id=\"settingsModal\" title=\"Settings\" onClose={modalClose}>\r\n            <form onSubmit={isSending ? null : handleSubmit}>\r\n                <div>\r\n                    <label className=\"form-label\" htmlFor=\"name\">Name</label>\r\n                    <input className=\"form-control\" type=\"text\" name=\"name\"\r\n                        value={name} placeholder={initialUser.name}\r\n                        onChange={e => dispatch({ type: 'field', fieldName: 'name', payload: e.target.value })} />\r\n                </div>\r\n                <div className=\"mt-2\">\r\n                    <label className=\"form-label\" htmlFor=\"email\">Email</label>\r\n                    <input className=\"form-control\" type=\"email\" name=\"email\"\r\n                        value={email} placeholder={initialUser.email}\r\n                        onChange={e => dispatch({ type: 'field', fieldName: 'email', payload: e.target.value })} />\r\n                </div>\r\n                <div className=\"mt-2\">\r\n                    <label className=\"form-label\" htmlFor=\"password\">Password</label>\r\n                    <input className=\"form-control\" type=\"password\" name=\"password\"\r\n                        value={password} onChange={e => dispatch({ type: 'field', fieldName: 'password', payload: e.target.value })} />\r\n                </div>\r\n                <div className=\"d-flex align-items-center mt-2\">\r\n                    <button disabled={isSending || !isInitialLoaded} type=\"submit\" className=\"btn btn-primary\">\r\n                        Change\r\n                    </button>\r\n\r\n                    {\r\n                        isSending &&\r\n                        <div className=\"ml-2 spinner-grow\" />\r\n                    }\r\n                </div>\r\n            </form>\r\n            {\r\n                error &&\r\n                <div className=\"alert alert-danger mt-2 mb-0\">\r\n                    {error ? error : 'Error while logging in.'}\r\n                </div>\r\n            }\r\n            {\r\n                success &&\r\n                <div className=\"alert alert-success mt-2 mb-0\">\r\n                    {success}\r\n                </div>\r\n            }\r\n        </Modal>\r\n    )\r\n}\r\n\r\nexport default Settings","module.exports = require(\"regenerator-runtime\");\n","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","import axios from '../helpers/axios'\r\nimport authHeader from '../helpers/authHeader'\r\n\r\n\r\nexport const me = (params) => axios.get('users/me', { params, headers: authHeader() })\r\nexport const partialUpdate = (body) => axios.patch('users', body, { headers: authHeader() })\r\n\r\nexport const userService = {\r\n    login,\r\n    logout,\r\n    register\r\n};\r\n\r\nfunction login(username, password) {\r\n\r\n    let loginHeaderMy = null\r\n\r\n    const requestOptions = {\r\n        method: 'POST',\r\n        headers: loginHeaderMy\r\n\r\n    };\r\n\r\n    return fetch(`${process.env.REACT_APP_API_URL}/users/auth`, requestOptions)\r\n        .then(handleResponse)\r\n        .then(user => {\r\n            localStorage.setItem('user', JSON.stringify(user));\r\n            return user;\r\n        })\r\n}\r\n\r\nfunction logout() {\r\n    localStorage.removeItem('user');\r\n}\r\n\r\nfunction register(user) {\r\n    const requestOptions = {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(user)\r\n    };\r\n    return fetch(`${process.env.REACT_APP_API_URL}/users/`, requestOptions)\r\n        .then(handleResponse);\r\n}\r\n\r\nfunction handleResponse(response) {\r\n    return response.text().then(text => {\r\n        const data = text && JSON.parse(text);\r\n        if (!response.ok) {\r\n            if (response.status === 401) {\r\n                logout();\r\n            }\r\n            const error = (data && data.errors) || response.statusText;\r\n            return Promise.reject(error);\r\n        }\r\n        return data;\r\n    })\r\n}\r\n\r\n"],"sourceRoot":""}