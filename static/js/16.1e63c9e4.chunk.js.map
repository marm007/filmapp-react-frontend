{"version":3,"sources":["components/modals/settings/reducer.js","components/modals/settings/index.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator/index.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","services/userService.js"],"names":["userInitialState","name","email","settingsInitialState","password","initialUser","isInitialLoaded","isSubmitted","isSending","error","success","settingsReducer","state","action","type","fieldName","payload","Settings","useContext","UserContext","user","clearUser","updateUser","history","useHistory","location","useLocation","useReducer","dispatch","useEffect","auth","replace","process","push","a","userApi","then","res","data","catch","err","console","getUser","toUpdate","setTimeout","pathname","slice","search","accessToken","response","updateUserData","id","title","onClose","goBack","onSubmit","e","preventDefault","className","htmlFor","value","placeholder","onChange","target","disabled","module","exports","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","done","Promise","_asyncToGenerator","fn","self","this","args","arguments","apply","undefined","me","params","axios","get","headers","authHeader","partialUpdate","body","patch"],"mappings":"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","file":"static/js/16.1e63c9e4.chunk.js","sourcesContent":["const userInitialState = {\n    name: '',\n    email: ''\n}\n\nexport const settingsInitialState = {\n    ...userInitialState,\n    password: '',\n    initialUser: userInitialState,\n    isInitialLoaded: false,\n    isSubmitted: false,\n    isSending: false,\n    error: '',\n    success: ''\n}\n\nexport const settingsReducer = (state, action) => {\n    switch (action.type) {\n        case 'field': {\n            return {\n                ...state,\n                error: '',\n                [action.fieldName]: action.payload\n            }\n        }\n        case 'initial-success': {\n            return {\n                ...state,\n                initialUser: {\n                    email: action.email,\n                    name: action.name\n                },\n                isInitialLoaded: true\n            }\n        }\n        case 'submit': {\n            return {\n                ...state,\n                isSubmitted: true,\n                error: null,\n            }\n        }\n        case 'send': {\n            return {\n                ...state,\n                isSending: true\n            }\n        }\n        case 'success': {\n            return {\n                ...state,\n                isSubmitted: false,\n                isSending: false,\n                success: 'Changes saved successfully!',\n                error: null\n            }\n        }\n        case 'error': {\n            return {\n                ...state,\n                isSending: false,\n                isSubmitted: false,\n                error: action.payload\n            }\n        }\n        default: return state\n    }\n}","import React, { useEffect, useReducer, useContext } from \"react\";\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport UserContext from \"../../../helpers/contexts/user/userContext\";\nimport { settingsInitialState, settingsReducer } from \"./reducer\";\nimport * as userApi from '../../../services/userService'\nimport Modal from \"../../helpers/modal\";\n\nconst Settings = () => {\n\n    const { user, clearUser, updateUser } = useContext(UserContext)\n\n    let history = useHistory()\n    let location = useLocation()\n\n    const [state, dispatch] = useReducer(settingsReducer, settingsInitialState)\n    // eslint-disable-next-line no-unused-vars\n    const { email, name, password, initialUser, isSubmitted, isSending, isInitialLoaded, success, error } = state\n\n\n    useEffect(() => {\n        if (!user.auth && user.isInitialLoaded) {\n            history.replace(`${process.env.REACT_APP_PATH_NAME}`)\n            history.push(`${process.env.REACT_APP_PATH_NAME}login`)\n            clearUser()\n        }\n    }, [user, history, clearUser])\n\n    useEffect(() => {\n        async function getUser() {\n            await userApi.me()\n                .then(res => {\n                    dispatch({\n                        type: 'initial-success',\n                        name: res.data.name,\n                        email: res.data.email\n                    })\n                })\n                .catch(err => {\n                    console.error(err)\n                    dispatch({\n                        type: 'error',\n                        payload: true\n                    })\n                })\n        }\n        getUser()\n    }, [])\n\n    useEffect(() => {\n        async function updateUserData() {\n            let toUpdate = {}\n            if (password) toUpdate = { password: password }\n            if (email && email !== '' && email !== initialUser.email) toUpdate = { ...toUpdate, email: email }\n            if (name && name !== '' && name !== initialUser.name) toUpdate = { ...toUpdate, name: name }\n\n            await userApi.partialUpdate(toUpdate)\n                .then(res => {\n                    dispatch({\n                        type: 'success'\n                    })\n\n                    setTimeout(() => {\n                        let pathname = location.pathname.slice(0, -9)\n                        if (pathname === '') pathname = process.env.REACT_APP_PATH_NAME\n                        history.replace({\n                            pathname: pathname,\n                            search: location.search,\n                            state: location.state\n                        })\n                        updateUser(res.data.accessToken)\n                    }, 500)\n                })\n                .catch(err => {\n                    console.error(err)\n                    dispatch({\n                        type: 'error',\n                        payload: err.response && err.response.data && err.response.data.error ? err.response.data.error : 'Something went wrong!'\n                    })\n                })\n        }\n        if (isSending) updateUserData()\n    }, [email, initialUser.email, initialUser.name, isSending, name, password, history, location, updateUser])\n\n\n    const handleSubmit = (e) => {\n        e.preventDefault()\n\n        dispatch({\n            type: 'submit'\n        })\n\n        if (password ||\n            (email && email !== '' && email !== initialUser.email) ||\n            (name && name !== '' && name !== initialUser.name)) {\n            dispatch({\n                type: 'send'\n            })\n        }\n    }\n\n    const modalClose = () => {\n        history.goBack()\n    }\n\n    return (\n        <Modal id=\"settingsModal\" title=\"Settings\" onClose={modalClose}>\n            <form onSubmit={isSending ? null : handleSubmit}>\n                <div>\n                    <label className=\"form-label\" htmlFor=\"name\">Name</label>\n                    <input className=\"form-control\" type=\"text\" name=\"name\"\n                        value={name} placeholder={initialUser.name}\n                        onChange={e => dispatch({ type: 'field', fieldName: 'name', payload: e.target.value })} />\n                </div>\n                <div className=\"mt-2\">\n                    <label className=\"form-label\" htmlFor=\"email\">Email</label>\n                    <input className=\"form-control\" type=\"email\" name=\"email\"\n                        value={email} placeholder={initialUser.email}\n                        onChange={e => dispatch({ type: 'field', fieldName: 'email', payload: e.target.value })} />\n                </div>\n                <div className=\"mt-2\">\n                    <label className=\"form-label\" htmlFor=\"password\">Password</label>\n                    <input className=\"form-control\" type=\"password\" name=\"password\"\n                        value={password} onChange={e => dispatch({ type: 'field', fieldName: 'password', payload: e.target.value })} />\n                </div>\n                <div className=\"d-flex align-items-center mt-2\">\n                    <button disabled={isSending || !isInitialLoaded} type=\"submit\" className=\"btn btn-primary\">\n                        Change\n                    </button>\n\n                    {\n                        isSending &&\n                        <div className=\"ml-2 spinner-grow\" />\n                    }\n                </div>\n            </form>\n            {\n                error &&\n                <div className=\"alert alert-danger mt-2 mb-0\">\n                    {error ? error : 'Error while logging in.'}\n                </div>\n            }\n            {\n                success &&\n                <div className=\"alert alert-success mt-2 mb-0\">\n                    {success}\n                </div>\n            }\n        </Modal>\n    )\n}\n\nexport default Settings","module.exports = require(\"regenerator-runtime\");\n","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","import axios from '../helpers/axios'\nimport authHeader from '../helpers/authHeader'\n\n\nexport const me = (params) => axios.get('users/me', { params, headers: authHeader() })\nexport const partialUpdate = (body) => axios.patch('users', body, { headers: authHeader() })\n\nexport const userService = {\n    login,\n    logout,\n    register\n};\n\nfunction login(username, password) {\n\n    let loginHeaderMy = null\n\n    const requestOptions = {\n        method: 'POST',\n        headers: loginHeaderMy\n\n    };\n\n    return fetch(`${process.env.REACT_APP_API_URL}/users/auth`, requestOptions)\n        .then(handleResponse)\n        .then(user => {\n            localStorage.setItem('user', JSON.stringify(user));\n            return user;\n        })\n}\n\nfunction logout() {\n    localStorage.removeItem('user');\n}\n\nfunction register(user) {\n    const requestOptions = {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(user)\n    };\n    return fetch(`${process.env.REACT_APP_API_URL}/users/`, requestOptions)\n        .then(handleResponse);\n}\n\nfunction handleResponse(response) {\n    return response.text().then(text => {\n        const data = text && JSON.parse(text);\n        if (!response.ok) {\n            if (response.status === 401) {\n                logout();\n            }\n            const error = (data && data.errors) || response.statusText;\n            return Promise.reject(error);\n        }\n        return data;\n    })\n}\n\n"],"sourceRoot":""}