(this.webpackJsonpfilmapp_frontened=this.webpackJsonpfilmapp_frontened||[]).push([[20],{515:function(e,t,i){"use strict";i.r(t);var a=i(524),r=i.n(a),n=i(525),s=i(44),c=(i(691),i(1)),l=i(7),o=i(530),d=i(539),u=i(136),m=i(15),f=function(e){return{file:null,name:e?b:j,preview:null}},p={type:"",message:""},b="Choose a film ",j="Choose a thumbnail ",h={title:"",description:"",film:f(!0),thumbnail:f(!1),isSubmitted:!1,isSending:!1,isSuccess:!1,isError:!1,error:null},v=function(e,t){switch(t.type){case"field":return Object(m.a)(Object(m.a)({},e),{},Object(u.a)({isError:!1,error:null},t.fieldName,t.payload));case"file-add":return!0===t.isFilm?Object(m.a)(Object(m.a)({},e),{},{isError:!1,error:null,alert:p,film:{file:t.file,name:t.fileName,preview:t.preview}}):Object(m.a)(Object(m.a)({},e),{},{isError:!1,error:null,alert:p,thumbnail:{file:t.file,name:t.fileName,preview:t.preview}});case"file-clear":return!0===t.isFilm?Object(m.a)(Object(m.a)({},e),{},{isError:!1,error:null,film:f(!0)}):Object(m.a)(Object(m.a)({},e),{},{isError:!1,error:null,thumbnail:f(!1)});case"submit":return Object(m.a)(Object(m.a)({},e),{},{isError:!1,error:null,alert:p,isSubmitted:!0});case"send":return Object(m.a)(Object(m.a)({},e),{},{isSending:!0});case"success":return Object(m.a)(Object(m.a)({},e),{},{isSending:!1,isSuccess:!0});case"error":return Object(m.a)(Object(m.a)({},e),{},{isSending:!1,isSuccess:!1,isError:!0,error:t.payload});case"error-422":return Object(m.a)(Object(m.a)({},e),{},{isSending:!1,isSuccess:!1,isError:!0,error:t.payload,film:f(!0),thumbnail:f(!1)});default:return e}},O=i(540),x=i(80),g=i(2);t.default=function(){var e=Object(c.useContext)(x.a),t=e.user,i=e.clearUser,a=Object(l.g)(),u=Object(c.useRef)(null),m=Object(c.useRef)(null),f=Object(c.useReducer)(v,h),p=Object(s.a)(f,2),y=p[0],N=p[1],w=y.title,A=y.description,E=y.film,C=y.thumbnail,S=y.isSubmitted,R=y.isSending,k=y.isError,F=y.error;Object(c.useEffect)((function(){!t.auth&&t.isInitialLoaded&&(a.replace("".concat("/filmapp-react-frontend/")),a.push("".concat("/filmapp-react-frontend/","login")),i())}),[t,a,i]),Object(c.useEffect)((function(){function e(){return(e=Object(n.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new FormData).set("title",w),t.set("description",A),t.set("film",E.file),t.set("thumbnail",C.file),e.next=7,O.b(t).then((function(e){N({type:"success"}),a.push("".concat("/filmapp-react-frontend/","film/").concat(e.data.id))})).catch((function(e){var t=null;e.response&&e.response.data&&e.response.data.error?t=e.response.data.error:e.response&&e.response.data&&e.response.data.errors&&(e.response.data.errors.description?t=e.response.data.errors.description.message:e.response.data.errors.title&&(t=e.response.data.errors.title.message)),422===e.response.status?N({type:"error-422",payload:t}):N({type:"error",payload:t})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}R&&function(){e.apply(this,arguments)}()}),[A,E.file,a,R,C.file,w]);var L=function(e,t){switch(e.preventDefault(),t){case"film":N({type:"file-add",isFilm:!0,file:u.current.files[0],fileName:u.current.files[0].name,preview:URL.createObjectURL(e.target.files[0])});break;case"thumbnail":N({type:"file-add",isFilm:!1,file:m.current.files[0],fileName:m.current.files[0].name,preview:URL.createObjectURL(e.target.files[0])})}};return Object(g.jsxs)("div",{className:"row my-4 mx-2 h-100 container mx-auto",children:[Object(g.jsx)("div",{className:"col col-12 col-md-6 m-0 mb-4",children:Object(g.jsx)("div",{children:Object(g.jsxs)("div",{className:"position-relative justify-content-center d-flex align-items-center text-center box has-advanced-upload",children:[Object(g.jsx)("div",{className:"embed-responsive embed-responsive-16by9 ",children:Object(g.jsx)("video",{muted:!0,autoPlay:!0,className:"embed-responsive-item",loop:!0,src:E.preview?E.preview:""})}),Object(g.jsx)("input",{id:"film",accept:"video/mp4, video/ogg",onChange:function(e){return L(e,"film")},type:"file",ref:u,className:"inputfile"}),Object(g.jsx)("label",{htmlFor:"film",className:"position-absolute",children:E.name===b&&Object(g.jsx)("span",{children:E.name})}),E.preview&&Object(g.jsx)("div",{className:"col card-img-overlay film-add-item-opacity"}),E.preview&&Object(g.jsx)(o.a,{className:"film-add-item-middle fa-3x text-white",icon:"times",onClick:function(){N({type:"file-clear",isFilm:!0})}})]})})}),Object(g.jsx)("div",{className:"col col-12 col-md-6 m-0 mb-4",children:Object(g.jsx)("div",{children:Object(g.jsxs)("div",{className:"position-relative justify-content-center d-flex align-items-center text-center box has-advanced-upload",children:[Object(g.jsx)("div",{className:"embed-responsive embed-responsive-16by9 ",children:Object(g.jsx)("img",{className:"embed-responsive-item",alt:"",src:C.preview?C.preview:"data:image/gif;base64,R0lGODlhAQABAPAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="})}),Object(g.jsx)("input",{id:"thumbnail",accept:"image/jpg, image/png, image/jpeg",onChange:function(e){return L(e,"thumbnail")},type:"file",ref:m,className:" inputfile position-absolute"}),Object(g.jsx)("label",{htmlFor:"thumbnail",className:"position-absolute",children:C.name===j&&Object(g.jsx)("span",{children:C.name})}),C.preview&&Object(g.jsx)("div",{className:"col card-img-overlay film-add-item-opacity"}),C.preview&&Object(g.jsx)(o.a,{className:"film-add-item-middle fa-3x text-white",icon:"times",onClick:function(){N({type:"file-clear",isFilm:!1})}})]})})}),Object(g.jsxs)("div",{className:"col col-12 col-md-12 m-0 ml-auto mr-auto mb-4 mb-md-0",children:[Object(g.jsxs)("div",{className:"mb-3",children:[Object(g.jsx)(d.a,{placeholder:"Title",type:"text",isInvalid:S&&!w,name:"title",value:w,onChange:function(e){return N({type:"field",fieldName:"title",payload:e.target.value})}}),Object(g.jsx)("div",{className:"invalid-feedback",children:"Title is required"})]}),Object(g.jsxs)("div",{className:"mb-3",children:[Object(g.jsx)(d.a,{placeholder:"Description",type:"textarea",isInvalid:S&&!A,name:"description",value:A,onChange:function(e){return N({type:"field",fieldName:"description",payload:e.target.value})}}),Object(g.jsx)("div",{className:"invalid-feedback",children:"Description is required"})]}),Object(g.jsx)("div",{className:"col-12 mb-3 p-0",children:Object(g.jsxs)("div",{className:"d-flex align-items-center justify-content-end",children:[R&&Object(g.jsx)("div",{className:"spinner-grow mr-2"}),Object(g.jsx)("button",{className:"btn btn-primary",disabled:R||!w||!A,onClick:R?null:function(e){e.preventDefault(),N({type:"submit"}),t.auth?w&&A&&N({type:"send"}):a.push("".concat("/filmapp-react-frontend/","add/login"))},children:"Add"})]})}),k&&Object(g.jsx)("div",{className:"alert alert-danger",children:F||"Error while creating film."})]})]})}},539:function(e,t,i){"use strict";var a=i(1),r=i(2);t.a=function(e){var t=e.isInvalid,i=e.onChange,n=e.type,s=e.name,c=e.value,l=e.placeholder,o=void 0===l?"":l,d="textarea"===n?"textarea":"input",u=Object(a.useRef)(null);return Object(a.useEffect)((function(){u.current&&(t?u.current.classList.add("is-invalid"):u.current.classList.remove("is-invalid"))}),[t]),Object(r.jsx)(d,{ref:u,className:"form-control",placeholder:o,type:n,name:s,value:c,onChange:i})}},540:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return c})),i.d(t,"h",(function(){return l})),i.d(t,"i",(function(){return o})),i.d(t,"b",(function(){return d})),i.d(t,"f",(function(){return u})),i.d(t,"e",(function(){return m})),i.d(t,"g",(function(){return f}));var a=i(41),r=i(137),n=function(e){return a.a.get("films/",{params:e})},s=function(e){return a.a.get("films/".concat(e))},c=function(e){return a.a.get("films/".concat(e,"/details"))},l=function(e){return a.a.get("films/search",{params:e})},o=function(e){return a.a.patch("films/".concat(e,"/view"))},d=function(e){return a.a.post("films",e,{headers:Object(r.a)()})},u=function(e,t){return a.a.patch("films/".concat(e),t,{headers:Object(r.a)()})},m=function(e,t){return a.a.patch("films/".concat(e,"/action"),t,{headers:Object(r.a)()})},f=function(e){return a.a.delete("films/".concat(e),{headers:Object(r.a)()})}},691:function(e,t,i){}}]);
//# sourceMappingURL=20.5d215b42.chunk.js.map